#!/bin/bash
set -e

# ðŸ“¦ Variables
REPO_URL="git@github.com:tommyjou39/ton-projet.git"
VERSION=$(date +"v%Y.%m.%d-%H%M")
COMMIT_MSG="Auto-push: $VERSION"
CHANGELOG_FILE="changelog_$VERSION.md"

# ðŸ§¼ Nettoyage et build
make clean && make

# ðŸ“œ GÃ©nÃ©ration du changelog
echo "## Changelog $VERSION" > $CHANGELOG_FILE
git log -1 --pretty=format:"- %s (%h)" >> $CHANGELOG_FILE

# ðŸš€ Git operations
git add .
git commit -m "$COMMIT_MSG"
git tag "$VERSION"
git push origin main --tags

# ðŸ“¤ Publication (ex: Itch.io)
butler push ./build tommyjou39/ton-jeu:demo --userversion "$VERSION"

echo "âœ… Push + tag + changelog + publication terminÃ© !"
